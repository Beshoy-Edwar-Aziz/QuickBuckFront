import{a as U,b as S,d as j,e as D}from"./chunk-YVQFKZUR.js";import{c as K,d as X,e as Z,f as H}from"./chunk-3OSPXOK4.js";import"./chunk-5IC5DNT2.js";import{x as ee,z as te}from"./chunk-BDNT75Q5.js";import{a as L}from"./chunk-KAZFXK4U.js";import{a as $}from"./chunk-VVC45DNW.js";import{a as R,b as d,d as q,e as Q,l as A,m as G,o as z,p as Y}from"./chunk-GVASTDVW.js";import{a as oe}from"./chunk-NMXXHOSR.js";import{e as w}from"./chunk-74GY5GQ5.js";import{a as W}from"./chunk-ZLFBUOKE.js";import{b as V}from"./chunk-3FEZ7P6T.js";import"./chunk-EQ3IFVHN.js";import"./chunk-STEM5K4J.js";import{Ab as k,Eb as B,Fb as N,Gb as M,Ib as O,Oa as h,Pa as c,Qb as T,_a as x,eb as _,ga as F,gb as y,h as re,kb as P,la as E,pb as o,qb as n,rb as a,yb as J}from"./chunk-4IWQIHCA.js";var u=re(oe());function ne(i,r){i&1&&a(0,"app-loading")}function ae(i,r){if(i&1&&(o(0,"ngx-stripe-elements",7),a(1,"ngx-stripe-payment",9),n()),i&2){let g=k();y("stripe",g.stripe)("elementsOptions",g.elementsOptions),h(),y("options",g.paymentElementOptions)}}var Je=(()=>{let r=class r{constructor(l,e,t,s){this._paymentService=l,this._userService=e,this._authService=t,this._router=s,this.BalanceSet=localStorage.getItem("Balance"),this.ResultingBalance=JSON.parse(this.BalanceSet),this.ClientSecret=localStorage.getItem("ClientSecret"),this.JobProviderId=localStorage.getItem("JobProviderId"),this.JobProviderIdSet=JSON.parse(this.JobProviderId),this.Flag=!1,this.PaymentType=localStorage.getItem("PaymentType"),this.fb=F(z),this.paymentElementForm=this.fb.group({name:["John Doe",[d.required]],email:["support@ngx-stripe.dev",[d.required]],address:[""],zipcode:[""],city:[""],amount:[this.ResultingBalance+100,[d.required,d.pattern(/\d+/)]]}),this.elementsOptions={locale:"en",clientSecret:`${this.ClientSecret}`,appearance:{theme:"flat"}},this.paymentElementOptions={layout:{type:"tabs",defaultCollapsed:!1,radios:!1,spacedAccordionItems:!1}},this.stripe=D("pk_test_51PTQ9NP6POtDoiSmCEqxQpcn8KNvPLTYN1s10I8JO722kzeg0abK4cX1DqH6Mk62hzZLh7yItc3YcjA7L4mFWnUg00ejQcXONx"),this.paying=x(!1)}pay(){if(this.Flag=!0,this.paying()||this.paymentElementForm.invalid)return;this.paying.set(!0);let{name:l,email:e,address:t,zipcode:s,city:ie}=this.paymentElementForm.getRawValue();this.stripe.confirmPayment({elements:this.paymentElement.elements,confirmParams:{payment_method_data:{billing_details:{name:l,email:e,address:{line1:t,postal_code:s,city:ie}}}},redirect:"if_required"}).subscribe(v=>{if(this.paying.set(!1),v.error)this.Flag=!1,u.default.fire({title:"Payment Failed",icon:"error"}),alert({success:!1,error:v.error.message});else if(this.Flag=!1,u.default.fire({title:"Payment Successful",icon:"success"}),v.paymentIntent.status==="succeeded"){let C=this._authService.Token;if(C.sub=="JobProvider")this._userService.GetJobProviderByIdOrByUserName(this.JobProviderIdSet,"").subscribe({next:f=>{console.log(f),this._paymentService.updateBalance(f.wallet.id,this.ResultingBalance,this.PaymentType).subscribe({next:p=>{console.log(p),u.default.fire({title:"Your Wallet Balance Updated",icon:"success"}),this.PaymentType=="Sub"&&this._userService.updateJobProviderPremiumStatus(this.JobProviderIdSet,!0).subscribe({next:m=>{console.log(m),this._userService.updateUser(m)}}),this._router.navigate([`/CompanyProfile/${this.JobProviderIdSet}`])}})}});else if(C.sub=="JobSeeker"){let f=localStorage.getItem("JobSeekerId"),p=JSON.parse(f);this._userService.GetJobSeekerById(p).subscribe({next:m=>{this._paymentService.updateBalance(m.wallet.id,this.ResultingBalance,this.PaymentType).subscribe({next:b=>{console.log(b),u.default.fire({title:"Your Wallet Balance Updated",icon:"success"}),this.PaymentType=="Sub"&&this._userService.updateJobSeekerPremiumStatus(p,!0).subscribe({next:I=>{console.log(I),this._userService.updateUser(I)}}),this._router.navigate([`/UserProfile/${p}`])},error:b=>{console.log(b)}})},error:m=>{console.log(m)}})}}})}};r.\u0275fac=function(e){return new(e||r)(c($),c(W),c(V),c(w))},r.\u0275cmp=E({type:r,selectors:[["app-checkout"]],viewQuery:function(e,t){if(e&1&&B(S,5),e&2){let s;N(s=M())&&(t.paymentElement=s.first)}},standalone:!0,features:[T],decls:15,vars:3,consts:[[1,"d-flex","flex-column","w-50","m-auto",3,"formGroup"],["appearance","fill"],["matInput","","placeholder","name","formControlName","name"],["matInput","","placeholder","Email","type","email","formControlName","email"],["matInput","","placeholder","Address","formControlName","address"],["matInput","","placeholder","ZIP Code","formControlName","zipcode"],["matInput","","placeholder","city","formControlName","city"],[3,"stripe","elementsOptions"],["mat-button","",3,"click"],[3,"options"]],template:function(e,t){e&1&&(_(0,ne,1,0,"app-loading"),o(1,"div",0)(2,"mat-form-field",1),a(3,"input",2),n(),o(4,"mat-form-field",1),a(5,"input",3),n(),o(6,"mat-form-field",1),a(7,"input",4),n(),o(8,"mat-form-field",1),a(9,"input",5),n(),o(10,"mat-form-field",1),a(11,"input",6),n(),_(12,ae,2,3,"ngx-stripe-elements",7),o(13,"button",8),J("click",function(){return t.pay()}),O(14,"PAY"),n()()),e&2&&(P(0,t.Flag?0:-1),h(),y("formGroup",t.paymentElementForm),h(11),P(12,t.elementsOptions.clientSecret?12:-1))},dependencies:[H,Z,K,X,Y,R,q,Q,A,G,j,S,U,te,ee,L]});let i=r;return i})();export{Je as CheckoutComponent};
